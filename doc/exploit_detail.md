# aCropalypse GIF Exploit Detail

## What is aCropalypse

TBD

## Structure of aCropalypse binaries

The aCropalypse affected software may save illegal binaries when ovewrite file. 

If after overwrite binary is smaller than the binary before overwrite, part of the binary before overwrite will remain file. So, the file size will be the same before and after the overwrite. For example, this can happen when an image is cropped and overwritten.

![overwrile binary by aCropalypse affected software](acropalypse_overwrite_file.drawio.svg)

When there are such illegal binaries, we should consider the following.

- (1-a) Is it possible to detect the boundary between the overwrite binary and the binary before the overwrite?
- (1-b) Is it possible to extract information from the binary before the overwrite with head binary missing?

(1-a) is easy on common image binary , even GIF. In Most image file format specification, the end of image file is specified.

(1-b) may be difficult depending on the file format specification. This is because the head binary is lost and it is not known where it is missing from. However, in limited situation it is possible. For example, in PNG and GIF, it is possible to restore part of an image from a missing binary.

## Restore aCropalypse PNG

TBD

## Restore aCropalypse GIF

### Structure of GIF

TBD

### Decoding Normal GIF Algorithm

TBD

### 4 Probrems for Restore

TBD

#### (2-a) 

TBD

#### (2-b) 

TBD

#### (2-c) 

TBD

#### (2-d) 

TBD

### Restore Algorithm

- Search `Image Data` Sub-block. It may be start `0xFF` and verify GIF Image Data format.
- Search 12bit Clear Code of LZW compression(GIF). It may be `0b000100000000`.
  - Decompress LZW after Clear Code.
- Estimate width from cropped image.
- Encode image using cropped image palette.

## Detect and Fix aCropalypse GIF

TBD

### aCropalypse　affects GIF/PNG　others?

TBD

## Note

TBD